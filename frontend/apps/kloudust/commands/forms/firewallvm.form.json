{
    "id": "firewallvm",
    "command": "applyFirewallRuleset",
    "type": "kloudust_cmdline",
    "kloudust_cmdline_params": ["vm_name", "ruleset", "vnet"],
    
    "title": "{{{i18n.FirewallVMTitle}}}",
    
    "i18n": {
        "en": {
            "FirewallVMTitle": "Firewall virtual machine",
            "VMFirewallDescription": "Firewall a virtual machine. Complete the required fields and then submit to firewall the virtual machine.",
            "VMFirewallName": "Firewall ruleset name",
            "VMName": "Virtual machine name",
            "FieldValidationErrorGeneric": "Validation error",
            "FirewallVMSubmitLabel": "Firewall",
            "FirewallApply": "Apply",
            "FirewallRemove": "Remove"
        },
        "hi": {
            "FirewallVMTitle": "Firewall virtual machine",
            "VMFirewallDescription": "Firewall a virtual machine. Complete the required fields and then submit to firewall the virtual machine.",
            "VMFirewallName": "Firewall ruleset नाम",
            "VMName": "Virtual machine name",
            "FieldValidationErrorGeneric": "Validation error",
            "FirewallVMSubmitLabel": "Firewall",
            "FirewallApply": "Apply",
            "FirewallRemove": "Remove"
        },
        "ja": {
            "FirewallVMTitle": "Firewall virtual machine",
            "VMFirewallDescription": "Firewall a virtual machine. Complete the required fields and then submit to firewall the virtual machine.",
            "VMFirewallName": "Firewall ruleset 名",
            "VMName": "Virtual machine name",
            "FieldValidationErrorGeneric": "Validation error",
            "FirewallVMSubmitLabel": "Firewall",
            "FirewallApply": "Apply",
            "FirewallRemove": "Remove"
        },
        "zh": {
            "FirewallVMTitle": "Firewall virtual machine",
            "VMFirewallDescription": "Firewall a virtual machine. Complete the required fields and then submit to firewall the virtual machine.",
            "VMFirewallName": "Firewall ruleset 姓名",
            "VMName": "Virtual machine name",
            "FieldValidationErrorGeneric": "Validation error",
            "FirewallVMSubmitLabel": "Firewall",
            "FirewallActionCommandType": "Apply or remove firewall ruleset",
            "FirewallApply": "Apply",
            "FirewallRemove": "Remove"
        }
    },
    
    "form": {
        "description": "{{{i18n.VMFirewallDescription}}}",
    
        "required_label": "{{{i18n.Required}}}",
        "required_fields": [
        {"id": "vm_name", "type": "text", "placeholder": "{{{i18n.VMName}}}", "required": true, 
            "pattern":"[0-9a-zA-Z]+", "validation_error": "{{{i18n.FieldValidationErrorGeneric}}}",
            "value":"{{{APP_CONSTANTS.ENV._vms_form_data.name_raw}}}", 
            "readonly":"{{#APP_CONSTANTS.ENV._vms_form_data.name_raw}}true{{/APP_CONSTANTS.ENV._vms_form_data.name_raw}}"},
        {"id": "ruleset", "multioption": true, "type": "select", "label": "{{{i18n.VMFirewallName}}}", "options":[]},
        {"id": "vnet", "multioption": true, "type": "select", "label": "{{{i18n.VMVNetListCommand}}}", "options":[]},
        {"id": "firewall_action", "multioption": true, "type": "select", "label": "{{{i18n.FirewallActionCommandType}}}", 
        "options":[
            {"value":"apply", "label":"{{{i18n.FirewallApply}}}"}, 
            {"value":"remove", "label":"{{{i18n.FirewallRemove}}}"}
        ]}
        ],
    
        "load_javascript": [
            "const form = arguments[0]||{};",
            "const vm_name = form.required_fields[0].value",
            "const firewallRulesets = await $$.libapimanager.rest(APP_CONSTANTS.API_KLOUDUSTCMD, 'POST', {",
            "cmd: `listFirewallRulesets`, ", "project: $$.libsession.get(APP_CONSTANTS.ACTIVE_PROJECT)}, true);",
            "if(firewallRulesets.result){",
            "   for(const ruleset of firewallRulesets.rulesets) {",
            "       const rulesetlist = form.required_fields[form.required_fields.length-3];",
            "       rulesetlist.options.push({value: ruleset.name, label: ruleset.name});",
            "   }",
            "} else form.required_fields[form.required_fields.length-3].options.push({value: 'norulesetsfound', label: 'No Rulesets Found'});",
            "const vnetresult = await $$.libapimanager.rest(APP_CONSTANTS.API_KLOUDUSTCMD,",
            "'POST', { cmd: `getVMVnets ${vm_name}`, project: $$.libsession.get(APP_CONSTANTS.ACTIVE_PROJECT) }, true);",
            "const vnetlist = form.required_fields[form.required_fields.length-2];",
            "if(vnetresult.result){",
            "   for(const vnet of vnetresult.vnets) {",
            "       vnetlist.options.push({value: vnet, label: vnet});",
            "   }",
            "vnetlist.options.push({value: '', label: 'Public Vnet'});",
            "} else form.required_fields[form.required_fields.length-2].options.push({value: 'novnetsfound', label: 'No Vnets Found'});",
            "return form;"
    ],

        "submitlabel": "{{{i18n.FirewallVMSubmitLabel}}}",
        "submit_javascript": [
            "const retObject = arguments[0]||{};",
            "if (retObject.firewall_action == 'remove') retObject._override_form_command='removeFirewallRuleset';",
            "return true;"
        ]
    }   
}
